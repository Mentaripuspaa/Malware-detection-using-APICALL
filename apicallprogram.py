import pefile
import os
import mysql.connector

#mydb = mysql.connector.connect(
#  host="localhost",
#  user="root",
#  passwd="",
#  database="apicall" #Nama database
#)

#mycursor = mydb.cursor()

# Ubah nama APi_1 ini jika di database sudah ada tabel bernama itu
#sql = "CREATE TABLE API_calls (id INT AUTO_INCREMENT PRIMARY KEY,File_Name  CHAR(100) NOT NULL,API_Name  CHAR(100) NOT NULL,Dll_Name  CHAR(100) NOT NULL)"

#mycursor.execute(sql)

API_list = []
DLL_list = []
TPF_list = []
signature_list = []
PATH = "D:\DATASET/DEMO1"
i = 1;
for FILE in os.listdir(PATH):
    current_file = os.path.join(PATH, FILE)
    pe = pefile.PE(current_file)
    for entry in pe.DIRECTORY_ENTRY_IMPORT:
        DLLNAME = entry.dll
        for API in entry.imports:
            API_list.append(API.name)
            str(FILE)
            str(API.name)
            str(DLLNAME)
            #sql = "INSERT INTO API_calls (File_Name, API_Name,Dll_Name) VALUES (%s, %s, %s)" #Ubah juga nama API_1 ini sesuai nama tabel yang dibuat
            #val = (FILE, API.name, DLLNAME)
            #mycursor.execute(sql, val)
            #mydb.commit()
            i=i+1;

#print(i, " Data telah masuk ke database")
print(API_list)

